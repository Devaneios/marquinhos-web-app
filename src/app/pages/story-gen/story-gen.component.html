<div class="config">
  <cdk-accordion class="accordion">
    <cdk-accordion-item
      #accordionItem="cdkAccordionItem"
      class="accordion-item"
      role="button"
      tabindex="0"
      [attr.id]="'accordion-header-0'"
      [attr.aria-expanded]="accordionItem.expanded"
      [attr.aria-controls]="'accordion-body-0'"
    >
      <div class="accordion-item-header" (click)="accordionItem.toggle()">
        <p>Categoria</p>
        <div class="accordion-item-header-right">
          <label class="accordion-selected">
            {{ selectedCategory$ | async }}
          </label>
          <mat-icon *ngIf="!accordionItem.expanded"> expand_more </mat-icon>
          <mat-icon *ngIf="accordionItem.expanded"> expand_less </mat-icon>
        </div>
      </div>
      <div
        class="accordion-item-body"
        role="region"
        [style.display]="accordionItem.expanded ? '' : 'none'"
        [attr.id]="'accordion-body-0'"
        [attr.aria-labelledby]="'accordion-header-0'"
      >
        <mat-radio-group
          color="primary"
          class="options-list"
          aria-label="Select an option"
          [value]="categoryValue"
          (change)="onCategoryChange($event)"
        >
          <mat-radio-button value="artists">Artistas</mat-radio-button>
          <mat-radio-button value="albums">Álbuns</mat-radio-button>
          <mat-radio-button value="tracks">Músicas</mat-radio-button>
        </mat-radio-group>
      </div>
    </cdk-accordion-item>
    <cdk-accordion-item
      #accordionItem1="cdkAccordionItem"
      class="accordion-item"
      role="button"
      tabindex="0"
      [attr.id]="'accordion-header-1'"
      [attr.aria-expanded]="accordionItem1.expanded"
      [attr.aria-controls]="'accordion-body-1'"
    >
      <div class="accordion-item-header" (click)="accordionItem1.toggle()">
        <p>Período</p>
        <div class="accordion-item-header-right">
          <label class="accordion-selected">
            {{ selectedPeriod$ | async }}
          </label>
          <mat-icon *ngIf="!accordionItem1.expanded"> expand_more </mat-icon>
          <mat-icon *ngIf="accordionItem1.expanded"> expand_less </mat-icon>
        </div>
      </div>
      <div
        class="accordion-item-body"
        role="region"
        [style.display]="accordionItem1.expanded ? '' : 'none'"
        [attr.id]="'accordion-body-1'"
        [attr.aria-labelledby]="'accordion-header-1'"
      >
        <mat-radio-group
          color="primary"
          class="options-list"
          aria-label="Select an option"
          [value]="periodValue"
          (change)="onPeriodChange($event)"
        >
          <mat-radio-button value="7day">Última Semana</mat-radio-button>
          <mat-radio-button value="1month">Último Mês</mat-radio-button>
          <mat-radio-button value="3month">Últimos 3 meses</mat-radio-button>
          <mat-radio-button value="6month">Últimos 6 meses</mat-radio-button>
          <mat-radio-button value="12month">Último ano</mat-radio-button>
          <mat-radio-button value="overall">Desde o início</mat-radio-button>
        </mat-radio-group>
      </div>
    </cdk-accordion-item>
    <cdk-accordion-item
      #accordionItem2="cdkAccordionItem"
      class="accordion-item"
      role="button"
      tabindex="0"
      [attr.id]="'accordion-header-2'"
      [attr.aria-expanded]="accordionItem2.expanded"
      [attr.aria-controls]="'accordion-body-2'"
    >
      <div class="accordion-item-header" (click)="accordionItem2.toggle()">
        <p>Tema</p>
        <div class="accordion-item-header-right">
          <label class="accordion-selected">
            {{ selectedTheme$ | async }}
          </label>
          <mat-icon *ngIf="!accordionItem2.expanded"> expand_more </mat-icon>
          <mat-icon *ngIf="accordionItem2.expanded"> expand_less </mat-icon>
        </div>
      </div>
      <div
        class="accordion-item-body"
        role="region"
        [style.display]="accordionItem2.expanded ? '' : 'none'"
        [attr.id]="'accordion-body-2'"
        [attr.aria-labelledby]="'accordion-header-2'"
      >
        <mat-radio-group
          color="primary"
          class="options-list"
          aria-label="Select an option"
          [value]="themeValue"
          (change)="onThemeChange($event)"
        >
          <mat-radio-button value="light">Claro</mat-radio-button>
          <mat-radio-button value="dark">Escuro</mat-radio-button>
        </mat-radio-group>
      </div>
    </cdk-accordion-item>
    <cdk-accordion-item
      #accordionItem3="cdkAccordionItem"
      class="accordion-item"
      role="button"
      tabindex="0"
      [attr.id]="'accordion-header-3'"
      [attr.aria-expanded]="accordionItem3.expanded"
      [attr.aria-controls]="'accordion-body-3'"
    >
      <div class="accordion-item-header" (click)="accordionItem3.toggle()">
        <p>Borda</p>
        <div class="accordion-item-header-right">
          <label class="accordion-selected">
            {{ selectedBorder$ | async }}
          </label>
          <mat-icon *ngIf="!accordionItem3.expanded"> expand_more </mat-icon>
          <mat-icon *ngIf="accordionItem3.expanded"> expand_less </mat-icon>
        </div>
      </div>
      <div
        class="accordion-item-body"
        role="region"
        [style.display]="accordionItem3.expanded ? '' : 'none'"
        [attr.id]="'accordion-body-3'"
        [attr.aria-labelledby]="'accordion-header-3'"
      >
        <mat-radio-group
          color="primary"
          class="options-list"
          aria-label="Select an option"
          [value]="borderValue"
          (change)="onBorderChange($event)"
        >
          <mat-radio-button value="none">Sem borda</mat-radio-button>
          <mat-radio-button value="transparent"
            >Borda transparente</mat-radio-button
          >
        </mat-radio-group>
      </div>
    </cdk-accordion-item>
  </cdk-accordion>
  <div class="footer-actions">
    <button
      mat-raised-button
      class="preview-button"
      color="primary"
      [disabled]="loading"
      (click)="openPreview()"
    >
      Pré-visualizar
    </button>
  </div>
</div>

<div *ngIf="loading" class="loading overlay">
  <div>
    <h3>Consultando suas informações no Lastfm...</h3>
    <mat-spinner [diameter]="48"></mat-spinner>
  </div>
</div>

<div
  *ngIf="!loading && !!story && !story?.previewImageURL"
  class="loading overlay"
>
  <div>
    <h3>Pintando o story...</h3>
    <mat-spinner [diameter]="48"></mat-spinner>
  </div>
</div>

<div *ngIf="previewOpen" class="preview overlay">
  <mrq-lastfm-story
    #story
    [category]="categoryValue"
    [period]="periodValue"
    [username]="username"
    [lightTheme]="themeValue === 'light'"
    [transparentBorder]="borderValue === 'transparent'"
    [lastfmImages]="images"
  ></mrq-lastfm-story>
</div>

<div *ngIf="previewOpen" class="preview-actions">
  <button
    mat-fab
    class="preview-button"
    color="primary"
    (click)="closePreview()"
  >
    <mat-icon>arrow_back</mat-icon>
  </button>
  <button
    *ngIf="isSafari"
    mat-fab
    class="preview-button"
    color="primary"
    (click)="story.loadPreviewImage()"
  >
    <mat-icon>refresh</mat-icon>
  </button>
  <button mat-fab class="preview-button" color="primary" (click)="share()">
    <mat-icon>share</mat-icon>
  </button>
</div>
